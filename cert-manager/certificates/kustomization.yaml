# yaml-language-server: $schema=https://json.schemastore.org/kustomization
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- ./api.yaml
- ./apps.yaml
# Disabled until i know certs work
#  - ./patch-apps-ingress.yaml
replacements:
- source:
    kind: Secret
    name: cert-manager-secrets
    namespace: cert-manager
    fieldPath: stringData.SECRET_TLD.value
  targets:
  - select:
      group: cert-manager.io
      kind: Certificate
      name: apps-wildcard-cert-tls
      namespace: openshift-ingress
      version: v1
    fieldPaths:
    - spec.commonName
    options:
      delimiter: .
      index: 2

  # - fieldPaths:
  #   - spec.dnsNames.0
  #   options:
  #     delimiter: .
  #     index: 2
  #   select:
  #     group: cert-manager.io
  #     kind: Certificate
  #     name: apps-wildcard-cert-tls
  #     namespace: openshift-ingress
  #     version: v1
  # - fieldPaths:
  #   - spec.dnsNames.1
  #   options:
  #     delimiter: .
  #     index: 3
  #   select:
  #     group: cert-manager.io
  #     kind: Certificate
  #     name: apps-wildcard-cert-tls
  #     namespace: openshift-ingress
  #     version: v1
